(function() {
    function e(e, t) {
        if (!e) {
            return
        }
        var i;
        if (!window["_loadCss"] || window["_loadCss"].indexOf(e) < 0) {
            i = document.createElement("link");
            i.setAttribute("type", "text/css");
            i.setAttribute("rel", "stylesheet");
            i.setAttribute("href", e);
            i.setAttribute("id", "loadCss" + Math.random());
            document.getElementsByTagName("head")[0].appendChild(i);
            window["_loadCss"] ? window["_loadCss"] += "|" + e : window["_loadCss"] = "|" + e
        }
        i && typeof t == "function" && (i.onload = t);
        return true
    }
    var t = "//wq.360buyimg.com/fd/h5/wxsq_dev/m_common/css/commonFooter.min.css?t=201909101733";
    var i = {
        mPing4Click: function(e, t, i) {
            if (typeof MPing == "undefined") {} else {
                try {
                    var n = new MPing.inputs.Click(e);
                    n.event_param = t ? t : "";
                    n.event_level = i ? parseInt(i) : "";
                    var o = new MPing;
                    o.send(n)
                } catch (e) {}
            }
        },
        mPing4Exposure: function(e) {
            var t = new Image;
            if (e) {
                t.src = e
            }
        }
    };

    function n(e) {
        var t = [];
        for (var i in e) {
            t.push(encodeURIComponent(i) + "=" + encodeURIComponent(e[i]))
        }
        t.push("xx=" + Math.floor(Math.random() * 1e4 + 500));
        return t.join("&")
    }
    var o = {
        ajax: function(e) {
            var t;
            try {
                t = new ActiveXObject("Msxml2.XMLHTTP")
            } catch (e) {
                try {
                    t = new ActiveXObject("Microsoft.XMLHTTP")
                } catch (e) {
                    t = new XMLHttpRequest
                }
            }
            t.ajaxRunError = true;
            if (e.withCredentials) {
                try {
                    t.withCredentials = true
                } catch (e) {}
            }
            try {
                t.open(e.method, e.url, e.async);
                t.onreadystatechange = function() {
                    var i = e.source ? e.source : null;
                    if (t.readyState == 4) {
                        if (t.status == 200) {
                            t.ajaxRunError = false;
                            var n = t.responseText;
                            e.success.call(i, n)
                        } else {
                            e.error.call(i)
                        }
                    }
                };
                if (e.data) {
                    t.send(e.data)
                } else {
                    t.send("{}")
                }
            } catch (e) {}
        },
        jsonp: function(e) {
            var t = e.jsonp;
            var i = document.getElementsByTagName("head")[0];
            var o = document.createElement("script");
            e.data["callback"] = t;
            var a = n(e.data);
            i.appendChild(o);
            o.src = e.url + "?" + a;
            window[t] = function(n) {
                i.removeChild(o);
                clearTimeout(o.timer);
                window[t] = null;
                e.success && e.success(n)
            };
            if (e.timeout) {
                o.timer = setTimeout(function() {
                    window[t] = null;
                    i.removeChild(o);
                    e.error && e.error({
                        message: "请求超时"
                    })
                }, e.timeout)
            }
        }
    };
    var a = {
        getCookie: function(e) {
            var t = "";
            var i = [];
            var n = "^" + e + "=";
            var o = new RegExp(n, "ig");
            if (document.cookie) {
                i = document.cookie.split(";");
                for (var a = 0, r = i.length; a < r; a++) {
                    if (o.test(i[a].trim())) {
                        t = i[a].split("=")[1];
                        break
                    }
                }
            }
            return t
        },
        setCookie: function(e, t, i, n, o) {
            var a = e + "=" + escape(t);
            if (i != "") {
                var r = new Date;
                r.setTime(r.getTime() + i * 24 * 3600 * 1e3);
                a += ";expires=" + r.toGMTString()
            }
            if (n != "") {
                a += ";path=" + n
            }
            if (o != "") {
                a += ";domain=" + o
            }
            document.cookie = a
        },
        delCookie: function(e) {
            var t = new Date;
            t.setTime(t.getTime() - 1);
            document.cookie = e + "=; expires=" + t.toGMTString()
        }
    };
    window.CommonFooter = function() {
        function n() {
            return "{" + '"footContent": {' + '"app": {' + '"image": "//m.360buyimg.com/mobilecms/jfs/t16423/186/2517573622/5186/75a541f7/5ab1c0deN947bdcba.png"' + "}," + '"intl": {' + '"image": "//m.360buyimg.com/mobilecms/jfs/t16090/145/2630217887/4548/251aa8bb/5ab46258Nfd600374.png",' + '"siteList": []' + "}," + '"pc": {' + '"image": "//m.360buyimg.com/mobilecms/jfs/t14581/218/2689195961/4696/203b872a/5ab1c0f2N51c3f1bb.png"' + "}" + "}" + "}"
        }

        function r(e) {
            var t;
            var i = "";
            var o = "";
            e = e ? e : n();
            e = JSON.parse(e);
            var a = e.footContent;
            var r = a.intl;
            var l = r.panelData;
            var m = "";
            if (e.pin) {
                i = '<a href="javascript: void(0)" clickUrl="https://passport.m.jd.com/user/login.action?"  ping-event-id="MCommonTail_Account">' + e.pin + "</a> ";
                o = '<a href="javascript: void(0)" clickUrl="https://passport.m.jd.com/user/logout.action?sid=76bf31011e946d54fbc73006c094fee2" ping-event-id="MCommonTail_Logout">退出</a>'
            } else {
                i = '<a href="javascript: void(0)" clickUrl="https://plogin.m.jd.com/user/login.action?appid=100&kpkey=&returnurl=http%3A%2F%2Fhome.m.jd.com%2FmyJd%2Fhome.action" ping-event-id="MCommonTail_Login">登录</a> ';
                o = '<a href="javascript: void(0)" clickUrl="https://plogin.m.jd.com/cgi-bin/mm/mreg?appid=461&returnurl=http%3A%2F%2Fhome.m.jd.com%2FmyJd%2Fhome.action&ipChanged=" ping-event-id="MCommonTail_Register">注册</a>'
            }
            var d = r.hasOwnProperty("panelData") && r.panelData.hasOwnProperty("siteList") && r.panelData.siteList.length > 0 ? true : false;
            if (r.labelImage && d) {
                m = '<img src="' + a.intl.labelImage + '" class="conmmon-icon-item-paster">'
            }
            if (!d) {
                console.log(JSON.parse(n()));
                a.intl.image = JSON.parse(n()).footContent.intl.image
            }
            var u = '<ul class="common-links">' + "<li>" + i + "</li>" + "<li>" + o + "</li>" + '<li><a href="javascript: void(0)" clickUrL="//wqs.jd.com/refund/help.shtml?channel=jd-m" ping-event-id="MCommonTail_FeedBack">客户服务</a></li>' + '<li><a href="javascript: void(0)" ping-event-id="MCommonTail_BackToTop" onclick="window.scrollTo(0,0);" style="border-right: 1px solid transparent">返回顶部</a></li>' + "</ul>" + (e.forbidCommFoot == "1" ? "" : '<ul class="common-icons">' + "<li>" + '<a href="javascript: void(0)"  clickUrL="//h5.m.jd.com/active/download/download.html?channel=jd-m" ping-event-id="MCommonTail_ToApp">' + '<img src="' + a.app.image + '" class="conmmon-icon-item">' + "</a>" + "</li>" + "<li>" + '<a href="javascript: void(0)" id="internationalSite" ping-event-id="MCommonTail_InterVersion">' + '<img src="' + a.intl.image + '" class="conmmon-icon-item">' + m + "</a>" + "</li>" + "<li>" + '<a href="javascript: void(0)"  clickUrL="//www.jd.com/#m" ping-event-id="MCommonTail_ToPC">' + '<img src="' + a.pc.image + '" class="conmmon-icon-item">' + "</a>" + "</li>" + "</ul>") + '<div class="common-copyright">Copyright © 2004-2019 京东JD.com 版权所有</div>';
            t = document.getElementById("mCommonFooter");
            if (t) {
                t.innerHTML = u
            } else {
                t = document.createElement("div");
                t.id = "mCommonFooter";
                t.innerHTML = u;
                document.body.appendChild(t)
            }
            t.classList.add("m-common-footer");
            var p = document.getElementById("internationalSite");
            var f = document.querySelectorAll("#mCommonFooter li>a");
            s.apply(f, null);
            p.addEventListener("click", function() {
                if (l && d) {
                    c(l)
                }
            })
        }

        function c(e) {
            var t = e.siteList;
            var i = "";
            for (var n = 0, o = t.length; n < o; n++) {
                if (t[n].icon && t[n].name && t[n].jumpUrl) {
                    i += '<li class="site-list">' + '<div class="site-list-item">' + '<img src="' + t[n].icon + '" alt="" class="site-list-item-flag">' + '<span class="site-list-item-name">' + t[n].name + "</span>" + '<a ref="javascript: void(0)" class="selected-icon-mask"  clickUrl="' + t[n].jumpUrl + '" ping-event-id="MCommonTail_ToastSiteEntrance">' + '<img src="' + e.selectImage + '" alt="" class="selected-icon">' + "</a>" + "</div>" + "</li>"
                }
            }
            var a = document.createElement("div");
            a.id = "footerCurtain";
            a.classList.add("m-common-footer-curtain");
            var r = '<div class="m-common-footer-curtain-wrapper">' + '<div class="footer-curtain-wrapper-content" id="maskWrapperContent">' + '<div class="footer-curtain-wrapper-content-title">' + '<div class="curtain-title-name">' + (e.title ? e.title : "可选站点") + "</div>" + '<div class="curtain-title-close">' + '<img src="' + e.closeImage + '" alt="" id="footerBtnClose">' + "</div>" + "</div>" + '<ul class="footer-curtain-wrapper-content-body" id="footerSiteList">' + i + "</ul>" + "</div>" + "</div>";
            a.innerHTML = r;
            document.body.appendChild(a);
            var c = document.getElementById("footerCurtain");
            c.addEventListener("click", function(e) {
                m()
            });
            var l = document.querySelector(".curtain-title-close");
            l.addEventListener("click", function(e) {
                e.preventDefault();
                e.stopPropagation()
            });
            var d = document.getElementById("footerBtnClose");
            d.addEventListener("click", function(e) {
                m()
            });
            var u = document.getElementById("maskWrapperContent");
            u.addEventListener("click", function(e) {
                e.preventDefault();
                e.stopPropagation()
            });
            u.style.marginTop = (window.screen.height - u.offsetHeight) / 2 + "PX";
            var p = document.querySelectorAll("#footerSiteList a");
            s.call(p, null)
        }

        function s() {
            for (var e = 0, t = this.length; e < t; e++) {
                this[e].addEventListener("click", function() {
                    l.apply(this, null)
                })
            }
        }

        function l() {
            var e = this.getAttribute("clickUrL");
            var t = this.getAttribute("ping-event-id");
            var n = escape(location.href);
            if (t == "MCommonTail_ToastSiteEntrance") {
                n = n + "_" + window.escape(this.getAttribute("clickurl"))
            }
            if (t == "MCommonTail_ToPC") {
                a.setCookie("pcm", "1", 1, "/", ".jd.com")
            }
            i.mPing4Click(t, n, null);
            setTimeout(function() {
                if (e) {
                    window.location.href = e
                }
            }, 200)
        }

        function m() {
            var e = document.getElementById("footerCurtain");
            if (e) {
                e.remove()
            }
        }

        function d() {
            e(t);
            o.ajax({
                url: "//mapi.m.jd.com/commonFoot/footInfo.json?_format_=json&isNewVersion=1&t=" + Math.random(),
                method: "GET",
                async: true,
                withCredentials: true,
                timeout: 1200,
                error: function() {
                    console.warn("common footer ajax error! ");
                    r(null)
                },
                success: function(e) {
                    r(e)
                }
            })
        }
        return {
            init: d
        }
    }();
    window.addEventListener("load", function() {
        CommonFooter.init()
    })
})();