export const ABEAGLE_ROUTE_PREFIX = 'track/abtest';

export const ABEAGLE_REQUEST_ROUTE = 'track/abeagle/request';

export function google(mapper) {
  const map = mapper.getOrCreateMap(ABEAGLE_ROUTE_PREFIX);
  map.addMapTo('category', 'ABTestRegister');
  map.addMapTo('action', '').mapFrom(src => `ab:${src.n}`);
  map.addMapTo('label', null).mapFrom(src => `${src.n}:${src.data.variation.value}`);
}

export function pixiedust(mapper) {
  const experimentStatusMap = mapper.getOrCreateMap(ABEAGLE_ROUTE_PREFIX);
  experimentStatusMap.addMapTo('type', 'experiment_status');
  experimentStatusMap.addMapTo('experiment_name', '').mapFrom('data.experiment');
  experimentStatusMap.addMapTo('experiment_id', null).mapFrom('data.variation.id');
  experimentStatusMap.addMapTo('experiment_version', null).mapFrom('data.variation.version');
  experimentStatusMap.addMapTo('variant_id', null).mapFrom('data.variation.variant_id');
  experimentStatusMap.addMapTo('variant_name', null).mapFrom('data.variation.value');

  const experimentRequestMap = mapper.getOrCreateMap(ABEAGLE_REQUEST_ROUTE);
  experimentRequestMap.addMapTo('type', 'experiment_request');
  experimentRequestMap.addMapTo('response_time_ms').mapFrom('data.responseTime');
}
