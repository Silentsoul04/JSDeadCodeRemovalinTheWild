import { Application } from 't3js';
import ads from '../../core/ads';
import prepareTemplate from '@buzzfeed/buzzblocks/js/services/nunjucks-env';
import { AdNativeVideoFormat } from '../../core';
import { ZONE1_BFNEWS } from '../../core/constants';
import moduleTemplate from './index.html';
import cardFooterTemplate from '../display-card-graphic/partials/_footer.html';
import newsFooterTemplate from '../../skins/news/partials/_sidebar-footer.html';


/**
 * DFP template: https://www.google.com/dfp/6556?#delivery/CreateNativeAdFormatAndStyle/nativeStyleId=122436&creativeTemplateId=11732990
 */

class AdDisplayCardNativeVideo extends AdNativeVideoFormat {
  buildFormat() {
    const templateData = this.getTemplateData();
    // video is inside ad iframe
    const video = ads.getSlotContainer(this.config.wid);
    let footerTpl = cardFooterTemplate;

    if (this.skin === ZONE1_BFNEWS) {
      footerTpl = newsFooterTemplate;
    }

    if (footerTpl !== null) {
      video.insertAdjacentHTML(
        'afterend', prepareTemplate(footerTpl).render(templateData)
      );
    }
    this.rootElement.classList.add('card');
    video.classList.add(
      'col', 'xs-col-12', 'xs-float-none', 'xs-overflow-hidden',
      'sm-col-5', 'sm-float-left', 'md-float-none', 'md-col-12'
    );
  }

  getTemplateData() {
    const templateData = Object.assign({}, this.ad);
    templateData.adPos = this.config.adPos; // for bfa tracking
    return templateData;
  }
}

AdDisplayCardNativeVideo.moduleTemplate = moduleTemplate;

Application.addModule('ad-display-card-native-video', AdDisplayCardNativeVideo.generateModule());


export { AdDisplayCardNativeVideo };
